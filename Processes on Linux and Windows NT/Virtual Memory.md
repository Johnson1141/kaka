# [虚拟内存](http://www.tldp.org/LDP/LG/issue23/flower/vmem.html)

虚拟内存提供了一种超过机器物理地址空间运行更多进程的机制。

每个即将运行在处理器上的进程都会分配字节的虚内存空间，它是一个逻辑地址空间，进程访问这个空间中的数据实现自己的任务。因为虚内存空间很大（通常上限是处理器的地址总线的位数以及每个处理器支持的最大进程数量），每个进程可以被分配一个很大的逻辑地址空间用于执行（通常是3GB）。

虚拟内存管理器用于确保执行中的进程使用的内存被映射到物理内存中，这是通过按需调页和页面置换机制实现的，需要的内存页换入物理内存，不需要的换出。调页（swapping）是指replacing a complete process with another in memory，换页是指从物理内存中删除一个内存页，然后替换成其他进程的内存页。调页和换页都是计算密集型操作，很消耗时间，因此需要仔细权衡成本和收益，设计了用于利用程序运行的局部性的算法以及延缓一些操作（例如内存拷贝）直到绝对必需的时刻来提高换页和调页的收益。

动态内存拥有的虚拟内存包含代码段和数据段。可执行的代码可能以共享库的方式被多个进程共享，因为代码段是只读的，它被写花的概率很小。进程可以在执行的时候分配或者链接并使用虚拟内存。

以Linux和Windows NT所代表的许多操作系统使用的一些内存管理机制如下：

* 页保护机制：每个虚拟内存页包含一些列标志位，它们用于确定这个内存页的在用户态和内核态的访问类型。
* 按需换页/缓式读取：虚拟内存页只在进程尝试访问时才被加载到物理内存中。
* 内核态/用户态操作：内核态可以访问进程的所有虚拟内存，但是用户态只能访问进程实际使用的内存。（译者注：内核态访问所有虚存可以直接换页，用户态访问不存在的内存需要换页。）
* 映射内存到文件：通过把物理内存页面换出到磁盘文件中暂存可以扩展物理内存。(Memory is extended by allowing disk files to be used as a staging area for pages swapped out of physical memory.)
* 写时复制：当两个进程需要访问同一个内存段时，虚拟内存管理器不会马上拷贝它，只有当这个内存段有写请求时才进行拷贝。
* 共享内存：一块内存可以通过特殊的操作映射到多个进程的地址空间中。
* 内存锁：为了确保关键的内存页不被换出物理内存，可以将内存页锁定，这样虚拟内存管理器就不会删除这个页面。
* 对象内存保护（仅限Windows NT）：NT的安全引用会在进程尝试打开或者映射内存句柄时检查进程是否有这个内存的访问权限。